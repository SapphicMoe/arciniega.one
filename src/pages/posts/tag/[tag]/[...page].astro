---
export const prerender = true;

import Posts from '@layouts/Post.astro';
import Pagination from '@components/blog/Pagination.astro';

import { getCollection } from 'astro:content';

const { tag } = Astro.params;
const { page } = Astro.props;

export async function getStaticPaths({ paginate }: { paginate: Function }) {
  const posts = await getCollection('posts');

  const tags = Array.from(new Set(posts.flatMap((post) => post.data.tags)));

  return tags.map((tag) => {
    return paginate(
      posts.filter((post) => tag && post.data.tags?.includes(tag)),
      {
        params: { tag },
        pageSize: 10,
      }
    );
  });
}
---

<Posts
  type="tags"
  title={`Posts with the tag ${tag}`}
  posts={page.data}
  description="A personal blog, comprising of whatever stuff I find interesting to post."
  total={page.total}
>
  <Pagination page={page} />
</Posts>
