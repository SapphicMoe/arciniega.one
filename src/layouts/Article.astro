---
export const prerender = true;

import Layout from '@layouts/Page.astro';

import '@fontsource/iosevka';

import Comments from '@components/blog/Comments.astro';
import Footer from '@components/Footer.astro';
import Line from '@components/Underline.astro';
import Link from '@components/Link.astro';

import { blog } from '@config';
import { format, parseISO } from 'date-fns';

interface Props {
  title: string;
  description?: string;
  created?: string;
  tag?: string;
  timeEstimate?: string;
  comments?: boolean;
}

const { comments, created, description, tag, timeEstimate, title } = Astro.props;

const checkComments = () => blog.comments && comments;

const formatDate = (date: Date) => format(date, 'MMM do, yyyy');
const createdAt = created ? formatDate(parseISO(created)) : null;

const backlinkPath = Astro.url.pathname.replace('/posts', '');
const backlink = new URL(backlinkPath, 'https://solstice.tf').href;
---

<Layout description={description} pageTitle={title} title={`${title} | Chloe Arciniega`}>
  <Line>Article</Line>
  {checkComments() && <meta slot="head" name="giscus:backlink" content={backlink} />}

  <section class="flex flex-col pt-2">
    <span>
      {
        tag && (
          <Link color="text-ctp-red" href={`/posts/tag/${tag}`} title={`Post tagged with ${tag}`}>
            {tag.toUpperCase()}
          </Link>
        )
      }
    </span>

    {title && <span class="title pt-1 text-4xl font-bold">{title}</span>}

    <span class="flex flex-row items-center pb-5 pt-2">
      <img
        src={blog.author.image}
        class="inline rounded-full"
        title={`Avatar of ${blog.author.name}`}
        alt={`Avatar of ${blog.author.name}`}
        width="24"
        height="24"
      />

      <span class="pl-2">
        <span class="font-semibold">{blog.author.name}</span>

        {createdAt && <span class="date">• published on {createdAt}</span>}

        • {timeEstimate}
      </span>
    </span>
  </section>

  <hr class="dark:text-ctp-pink" />

  <main class="article-content prose dark:prose-invert">
    <slot />
  </main>

  {checkComments() && <Comments />}
</Layout>
<Footer />

<style is:global>
  .article-content {
    @apply max-w-none;
    @apply text-xl;
    @apply pb-5 pt-5;

    & code:before,
    & code:after {
      content: '';
    }

    & code {
      @apply whitespace-pre-wrap;
    }

    & code > .line {
      @apply font-mono;
    }

    & :is(h1, h2, h3, h4, h5, h6) {
      @apply gap-1;
      @apply flex;

      & a {
        @apply transition delay-[1ms] ease-in;
        @apply opacity-0;
        @apply pl-1 pt-1 text-2xl;

        &:hover {
          @apply font-bold;
        }
      }

      &:hover a {
        @apply opacity-100;
      }
    }
  }
</style>
