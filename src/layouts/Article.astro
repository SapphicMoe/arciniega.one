---
export const prerender = true;

import Layout from '@layouts/Page.astro';

import { blog } from '@config';
import { format, parseISO } from 'date-fns';

import Comments from '@components/blog/Comments.astro';
import Line from '@components/base/Underline.astro';
import Link from '@components/base/Link.astro';
import Separator from '@components/base/Separator.astro';

import '@fontsource/iosevka';

interface Props {
  title: string;
  description?: string;
  created?: string;
  tag?: string;
  timeEstimate?: string;
  comments?: boolean;
}

const { comments, created, description, tag, timeEstimate, title } = Astro.props;

const checkComments = () => blog.comments && comments;

const formatDate = (date: Date) => format(date, 'MMM d, yyyy');
const createdAt = created ? formatDate(parseISO(created)) : null;

const backlinkPath = Astro.url.pathname.replace('/article', '');
const backlink = new URL(backlinkPath, 'https://solstice.tf').href;
---

<Layout description={description} pageTitle={title} title={`${title} | Chloe Arciniega`}>
  <Line>Article</Line>
  {checkComments() && <meta slot="head" name="giscus:backlink" content={backlink} />}

  <header class="flex flex-col">
    <span class="title pt-1 text-4xl font-bold">{title}</span>
    <span class="pt-2 italic">{description}</span>

    <span class="flex flex-row items-center gap-1 pb-3 pt-4">
      {createdAt}

      <Separator />
      <Link href={`/articles/tag/${tag}`} title={`Article tagged with ${tag}`}>
        {tag}
      </Link>

      <Separator />
      {timeEstimate}
    </span>
  </header>

  <hr class="dark:text-ctp-pink" />

  <span class="article-content prose dark:prose-invert">
    <slot />
  </span>

  {checkComments() && <Comments />}
</Layout>

<style is:global>
  .article-content {
    @apply max-w-none;
    @apply text-xl;
    @apply pb-5 pt-5;

    & code:before,
    & code:after {
      content: '';
    }

    & code {
      @apply whitespace-pre-wrap;
    }

    & code > .line {
      @apply font-mono;
    }

    & :is(h1, h2, h3, h4, h5, h6) {
      @apply gap-1;
      @apply flex;

      & a {
        @apply transition delay-[1ms] ease-in;
        @apply opacity-0;
        @apply pl-1 pt-1 text-2xl;

        &:hover {
          @apply font-bold;
        }
      }

      &:hover a {
        @apply opacity-100;
      }
    }
  }
</style>
